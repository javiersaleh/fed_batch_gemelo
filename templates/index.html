<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulación Fed-Batch</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Simulación de Bioreactor Fed-Batch</h1>

    <form id="simulation-form">
        <label for="tiempo_inicial">Tiempo Inicial (h):</label>
        <input type="number" id="tiempo_inicial" name="tiempo_inicial" step="0.1" value="0" required><br>

        <label for="tiempo_final">Tiempo Final (h):</label>
        <input type="number" id="tiempo_final" name="tiempo_final" step="0.1" value="2" required><br>

        <label for="C_O2">O2 disuelto (mg/L):</label>
        <input type="number" id="C_O2" name="C_O2" step="0.1" value="5.0" required><br>

        <label for="X">Biomasa (g/L):</label>
        <input type="number" id="X" name="X" step="0.1" value="0.1" required><br>

        <label for="S">Sustrato (g/L):</label>
        <input type="number" id="S" name="S" step="0.1" value="1.0" required><br>

        <label for="V">Volumen (L):</label>
        <input type="number" id="V" name="V" step="0.1" value="1.0" required><br>

        <button type="submit">Simular</button>
    </form>

    <canvas id="chart"></canvas>

    <script>
        document.getElementById('simulation-form').addEventListener('submit', function(event) {
            event.preventDefault();

            const formData = new FormData(event.target);
            const params = new URLSearchParams();
            formData.forEach((value, key) => {
                params.append(key, value);
            });

            fetch('/simulate', {
                method: 'POST',
                body: params
            })
            .then(response => response.json())
            .then(data => {
                const ctx = document.getElementById('chart').getContext('2d');
                const chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.tiempo,
                        datasets: [
                            {
                                label: 'O2 Disuelto (mg/L)',
                                data: data.O2,
                                borderColor: 'rgba(75, 192, 192, 1)',
                                fill: false
                            },
                            {
                                label: 'Biomasa (g/L)',
                                data: data.biomasa,
                                borderColor: 'rgba(54, 162, 235, 1)',
                                fill: false
                            },
                            {
                                label: 'Sustrato (g/L)',
                                data: data.sustrato,
                                borderColor: 'rgba(255, 206, 86, 1)',
                                fill: false
                            },
                            {
                                label: 'Volumen (L)',
                                data: data.volumen,
                                borderColor: 'rgba(153, 102, 255, 1)',
                                fill: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Tiempo (h)'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Concentración / Volumen'
                                }
                            }
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>
